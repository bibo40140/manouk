<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <title>Manouk - Gestion</title>
  <style>
    :root{
      --accent: #0b7bbf;
      --accent-dark: #095a8f;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --muted: #64748b;
      --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card: #ffffff;
      --border: #e2e8f0;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.15);
    }
    *{box-sizing:border-box}
    body{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin:0; height:100vh; display:flex; background:var(--bg);
    }
    aside{
      width:240px; 
      background:linear-gradient(180deg,#1e293b 0%,#0f172a 100%); 
      color:#fff; 
      padding:1.5rem; 
      display:flex; 
      flex-direction:column; 
      gap:8px;
      box-shadow:2px 0 10px rgba(0,0,0,0.2);
    }
    aside h2{
      margin:0 0 16px 0; 
      font-size:1.4rem;
      font-weight:700;
      background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .nav-btn{
      background:transparent; 
      color:rgba(255,255,255,0.8); 
      border:none; 
      padding:12px 14px; 
      text-align:left; 
      border-radius:8px; 
      cursor:pointer;
      transition:all 0.2s ease;
      font-size:0.95rem;
      font-weight:500;
    }
    .nav-btn:hover{
      background:rgba(255,255,255,0.08);
      color:#fff;
      transform:translateX(4px);
    }
    .nav-btn.active{
      background:linear-gradient(135deg, rgba(102,126,234,0.2) 0%, rgba(118,75,162,0.2) 100%);
      color:#fff;
      box-shadow:var(--shadow-sm);
    }
    main{
      flex:1;
      padding:24px;
      overflow:auto;
      background:#f1f5f9;
    }
    section{display:none}
    section.active{display:block}
    h1{
      margin:0 0 20px 0;
      font-size:1.8rem;
      font-weight:700;
      color:#1e293b;
    }
    h3{
      margin:24px 0 12px 0;
      font-size:1.2rem;
      font-weight:600;
      color:#334155;
    }
    .card{
      background:var(--card); 
      padding:20px; 
      border-radius:12px; 
      box-shadow:var(--shadow-md); 
      margin-bottom:16px;
      border:1px solid var(--border);
      transition:all 0.3s ease;
    }
    .card:hover{
      box-shadow:var(--shadow-lg);
      transform:translateY(-2px);
    }
    .treso{
      font-size:1.8rem;
      font-weight:700;
      background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Tabs */
    .tabs{margin-top:8px}
    .tab-nav{display:flex;gap:8px;margin-bottom:16px}
    .tab-btn{
      background:#fff;
      border:1px solid var(--border);
      padding:10px 16px;
      border-radius:8px;
      cursor:pointer;
      transition:all 0.2s ease;
      font-weight:500;
    }
    .tab-btn:hover{
      background:#f8fafc;
      border-color:var(--accent);
    }
    .tab-btn.active{
      background:var(--accent); 
      color:#fff; 
      border-color:var(--accent);
      box-shadow:var(--shadow-sm);
    }
    .tab-content .tab-pane{display:none}
    .tab-content .tab-pane.active{display:block}

    .form-row{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:12px;
      align-items:end;
    }
    label{
      font-size:0.9rem;
      color:var(--muted);
      font-weight:500;
    }
    input, select, textarea{
      padding:10px;
      border:1px solid var(--border);
      border-radius:8px;
      background:#fff;
      transition:all 0.2s ease;
      font-size:0.95rem;
    }
    input:focus, select:focus, textarea:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(11,123,191,0.1);
    }
    button.primary{
      background:linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      color:#fff;
      border:none;
      padding:10px 16px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      transition:all 0.2s ease;
      box-shadow:var(--shadow-sm);
    }
    button.primary:hover{
      transform:translateY(-2px);
      box-shadow:var(--shadow-md);
    }
    button.primary:active{
      transform:translateY(0);
    }
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:12px;
      background:#fff;
      border-radius:8px;
      overflow:hidden;
      box-shadow:var(--shadow-sm);
    }
    th{
      padding:12px;
      border-bottom:2px solid var(--border);
      text-align:left;
      background:#f8fafc;
      color:#334155;
      font-weight:600;
      font-size:0.9rem;
    }
    td{
      padding:10px 12px;
      border-bottom:1px solid #f1f5f9;
      text-align:left;
      color:#475569;
    }
    tr:hover td{
      background:#f8fafc;
    }
    ul{list-style:none;padding:0;margin:0}
    ul li{
      padding:12px;
      border:1px solid var(--border);
      background:#fff;
      border-radius:8px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      transition:all 0.2s ease;
      box-shadow:var(--shadow-sm);
    }
    ul li:hover{
      box-shadow:var(--shadow-md);
      transform:translateX(4px);
    }
    .muted{color:var(--muted);font-size:0.9rem}

    /* Toast notifications */
    #toast-container{
      position:fixed;
      top:20px;
      right:20px;
      z-index:10000;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .toast{
      background:#fff;
      padding:16px 20px;
      border-radius:8px;
      box-shadow:var(--shadow-lg);
      min-width:300px;
      max-width:400px;
      display:flex;
      align-items:center;
      gap:12px;
      animation:slideInRight 0.3s ease;
      border-left:4px solid var(--accent);
    }
    .toast.success{border-left-color:var(--success)}
    .toast.error{border-left-color:var(--danger)}
    .toast.warning{border-left-color:var(--warning)}
    .toast-icon{
      font-size:1.5rem;
      flex-shrink:0;
    }
    .toast-content{
      flex:1;
      color:#1e293b;
      font-size:0.9rem;
    }
    @keyframes slideInRight{
      from{transform:translateX(400px);opacity:0}
      to{transform:translateX(0);opacity:1}
    }
    @keyframes slideOutRight{
      from{transform:translateX(0);opacity:1}
      to{transform:translateX(400px);opacity:0}
    }

    /* Stats cards */
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:16px;
      margin-bottom:24px;
    }
    .stat-card{
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:var(--shadow-md);
      border-left:4px solid var(--accent);
      transition:all 0.3s ease;
      position:relative;
    }
    .stat-card:hover{
      box-shadow:var(--shadow-lg);
      transform:translateY(-4px);
    }
    .stat-label{
      font-size:0.85rem;
      color:var(--muted);
      font-weight:500;
      margin-bottom:8px;
    }
    .stat-value{
      font-size:1.6rem;
      font-weight:700;
      color:#1e293b;
    }
    .stat-card.success{border-left-color:var(--success)}
    .stat-card.success .stat-value{color:var(--success)}
    .stat-card.danger{border-left-color:var(--danger)}
    .stat-card.danger .stat-value{color:var(--danger)}
    .stat-card.warning{border-left-color:var(--warning)}
    .stat-card.warning .stat-value{color:var(--warning)}

    /* Pretty tooltips for stat cards */
    .stat-card[data-tooltip]:hover::after{
      content:attr(data-tooltip);
      position:absolute;
      left:12px;
      top:-8px;
      transform:translateY(-100%);
      background:#0f172a;
      color:#fff;
      padding:8px 10px;
      border-radius:8px;
      font-size:0.8rem;
      white-space:nowrap;
      box-shadow:var(--shadow-md);
      pointer-events:none;
      opacity:0.95;
    }
    .stat-card[data-tooltip]:hover::before{
      content:'';
      position:absolute;
      left:20px;
      top:-8px;
      transform:translateY(-100%);
      border:6px solid transparent;
      border-top-color:#0f172a;
    }

    /* Alerts */
    .alert{
      padding:16px;
      border-radius:8px;
      margin-bottom:16px;
      border-left:4px solid;
      background:#fff;
      box-shadow:var(--shadow-sm);
    }
    .alert.info{border-left-color:var(--accent);color:#0369a1}
    .alert.success{border-left-color:var(--success);color:#065f46}
    .alert.warning{border-left-color:var(--warning);color:#92400e}
    .alert.danger{border-left-color:var(--danger);color:#991b1b}

    /* Chart containers */
    .chart-container{
      position:relative;
      height:300px;
      margin:20px 0;
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:var(--shadow-md);
    }

    /* Badge styles */
    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:6px;
      font-size:12px;
      font-weight:600;
      white-space:nowrap;
    }
    .badge-ok{
      background:#d1fae5;
      color:#065f46;
    }
  </style>
</head>
<body>
  <aside>
    <h2>Manouk</h2>
    <button class="nav-btn active" data-target="dashboard">üìä Tableau de bord</button>
    <button class="nav-btn" data-target="invoices">üìÑ Factures</button>
    <button class="nav-btn" data-target="purchases">üßæ Achats</button>
    <button class="nav-btn" data-target="forecast">üí∞ Tr√©sorerie pr√©visionnelle</button>
    <button class="nav-btn" data-target="settings">‚öôÔ∏è Param√®tres</button>
  </aside>
  <main>
    <section id="dashboard" class="active">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <h1 style="margin:0">üìä Tableau de bord</h1>
        <label style="display:flex;align-items:center;gap:8px;font-weight:500">
          Filtrer soci√©t√©:
          <select id="dashboard-company-filter" style="min-width:180px;padding:10px;border:1px solid var(--border);border-radius:8px;background:#fff">
            <option value="all">Toutes les soci√©t√©s</option>
          </select>
        </label>
      </div>
      
      <!-- Stats cards modernis√©es -->
      <div class="stats-grid">
        <div class="stat-card success" data-tooltip="Somme des montants pay√©s sur les factures">
          <div class="stat-label">CA</div>
          <div class="stat-value" id="ca-value">0 ‚Ç¨</div>
        </div>
        <div class="stat-card" data-tooltip="Somme des montants restant dus sur les factures">
          <div class="stat-label">Cr√©ances</div>
          <div class="stat-value" id="receivables-value">0 ‚Ç¨</div>
        </div>
        <div class="stat-card" data-tooltip="Achats pay√©s (produits + mati√®res premi√®res)">
          <div class="stat-label">Achats</div>
          <div class="stat-value" id="suppliers-paid-value">0 ‚Ç¨</div>
        </div>
        <div class="stat-card warning" data-tooltip="Achats non pay√©s (produits + mati√®res premi√®res)">
          <div class="stat-label">Dettes</div>
          <div class="stat-value" id="payables-value">0 ‚Ç¨</div>
        </div>
        <div class="stat-card" data-tooltip="Montant URSSAF restant √† payer">
          <div class="stat-label">URSSAF</div>
          <div class="stat-value" id="urssaf-value">0 ‚Ç¨</div>
        </div>
        <div class="stat-card" data-tooltip="Factures pay√©es - achats pay√©s - URSSAF pay√©">
          <div class="stat-label">R√©sultat</div>
          <div class="stat-value" id="result-value">0 ‚Ç¨</div>
        </div>
        <div class="stat-card success" data-tooltip="Total factures - total achats - total URSSAF (pay√©s et en cours)">
          <div class="stat-label">Pr√©visionnel</div>
          <div class="stat-value" id="settled-net-value">0 ‚Ç¨</div>
        </div>
      </div>

      <!-- Alertes -->
      <div id="dashboard-alerts"></div>

      <!-- Graphiques -->
      <div class="card">
        <h3>üìà √âvolution du chiffre d'affaires (6 derniers mois)</h3>
        <div class="chart-container">
          <canvas id="revenue-chart"></canvas>
        </div>
      </div>

      <div class="card">
        <h3>üí∞ Rentabilit√© par produit (Top 10)</h3>
        <div class="chart-container">
          <canvas id="profitability-chart"></canvas>
        </div>
      </div>

      <h3>Factures r√©centes</h3>
      <table id="table-invoices-dashboard">
        <thead>
          <tr>
            <th>#</th><th>Soci√©t√©</th><th>Date</th><th>Client</th><th>Total</th><th>Pay√©</th><th>Restant</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h3>Achats r√©cents</h3>
      <table id="table-purchases-dashboard">
        <thead>
          <tr>
            <th>#</th><th>Soci√©t√©</th><th>Date</th><th>Fournisseur</th><th>Produit</th><th>Qt√©</th><th>Co√ªt</th><th>Pay√©</th><th>Restant</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="invoices">
      <h1>Factures</h1>
      <h3>Nouvelle facture</h3>
      <div>
        <button class="primary" id="btn-new-invoice" style="padding:10px 14px">Nouvelle facture</button>

        <!-- Inline form hidden: use the modal to create invoices -->
        <div id="invoice-inline-form" style="display:none">
          <label>Client
            <select id="invoice-customer"></select>
          </label>
          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="invoice-send-email" />
            <span>Envoyer automatiquement par email au client</span>
          </label>

          <div class="card" style="margin-top:8px">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
              <strong>Lignes de facture</strong>
              <div>
                <button id="btn-add-invoice-line" class="primary" style="padding:6px 10px">Ajouter une ligne</button>
              </div>
            </div>
            <div id="invoice-lines">
              <!-- rows inserted by renderer.js -->
            </div>
          </div>

          <div style="margin-top:8px">
            <button class="primary" id="btn-create-invoice">Cr√©er la facture</button>
          </div>
        </div>
      </div>

      <h3>Liste des factures</h3>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
        <label style="display:flex;align-items:center;gap:8px">Filtrer soci√©t√©:
          <select id="invoice-company-filter" style="min-width:160px">
            <option value="all">Toutes</option>
          </select>
        </label>
      </div>
      <div id="invoices-list" style="display:grid;gap:12px">
        <!-- Invoice cards will be inserted here -->
      </div>
    </section>

    <section id="forecast">
      <h1>üí∞ Tr√©sorerie pr√©visionnelle</h1>
      <p class="muted">Simulez vos ventes futures pour anticiper votre tr√©sorerie. Les co√ªts mati√®res et l'URSSAF sont calcul√©s automatiquement.</p>

      <div class="card">
        <h3>üìÖ Simulation de ventes (6 prochains mois)</h3>
        <div id="forecast-inputs" style="display:grid;gap:12px;margin-top:16px">
          <!-- Inputs dynamiques par produit et par mois -->
        </div>
        <div style="margin-top:16px;display:flex;gap:8px">
          <button class="primary" id="btn-calculate-forecast">üîÆ Calculer la simulation</button>
          <button id="btn-reset-forecast" style="padding:10px 16px;border:1px solid var(--border);background:#fff;border-radius:8px;cursor:pointer">üîÑ R√©initialiser</button>
        </div>
      </div>

      <div id="forecast-results" style="display:none">
        <div class="card">
          <h3>üìä R√©sultat de la simulation</h3>
          <div class="chart-container">
            <canvas id="forecast-chart"></canvas>
          </div>
        </div>

        <div class="card">
          <h3>üìã D√©tail mensuel</h3>
          <div style="overflow-x:auto">
            <table id="table-forecast">
              <thead>
                <tr>
                  <th>Mois</th>
                  <th>Ventes (unit√©s)</th>
                  <th>CA (‚Ç¨)</th>
                  <th>Co√ªt mati√®res (‚Ç¨)</th>
                  <th>URSSAF (22%)</th>
                  <th>Total d√©penses (‚Ç¨)</th>
                  <th>R√©sultat (‚Ç¨)</th>
                  <th>Solde cumul√© (‚Ç¨)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card success">
            <div class="stat-label">CA pr√©visionnel total</div>
            <div class="stat-value" id="forecast-total-revenue">0 ‚Ç¨</div>
          </div>
          <div class="stat-card danger">
            <div class="stat-label">D√©penses totales</div>
            <div class="stat-value" id="forecast-total-expenses">0 ‚Ç¨</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">R√©sultat net pr√©visionnel</div>
            <div class="stat-value" id="forecast-net-result">0 ‚Ç¨</div>
          </div>
          <div class="stat-card warning">
            <div class="stat-label">Solde final</div>
            <div class="stat-value" id="forecast-final-balance">0 ‚Ç¨</div>
          </div>
        </div>
      </div>
    </section>

    <section id="purchases">
      <h1>Achats de mati√®res premi√®res</h1>

      <h3>Nouvel achat</h3>
      <div>
        <label>Date
          <input type="date" id="purchase-date" />
        </label>
        <label>Mati√®re premi√®re
          <select id="purchase-material"></select>
        </label>
        <label>Soci√©t√©
          <select id="purchase-company"></select>
        </label>
        <label>Quantit√©
          <input type="number" id="purchase-qty" value="1" min="0.01" step="0.01"/>
        </label>
        <label>Co√ªt unitaire (‚Ç¨)
          <input type="number" id="purchase-unit-cost" value="0" min="0" step="0.01"/>
        </label>
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="purchase-paid-today" />
          Pay√© aujourd'hui
        </label>
        <button class="primary" id="btn-add-purchase">Enregistrer l'achat</button>
      </div>

      <h3>Historique des achats</h3>
      <table id="table-purchases">
        <thead>
          <tr>
            <th>#</th><th>Soci√©t√©</th><th>Date</th><th>Mati√®re</th><th>Qt√©</th><th>Co√ªt unitaire</th><th>Co√ªt total</th><th>Paiement</th><th>Livraison</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="settings">
      <h1>Param√®tres</h1>

      <div class="tabs">
        <nav class="tab-nav">
          <button class="tab-btn active" data-tab="tab-products">Produits</button>
          <button class="tab-btn" data-tab="tab-raw-materials">Mati√®res premi√®res</button>
          <button class="tab-btn" data-tab="tab-customers">Clients</button>
          <button class="tab-btn" data-tab="tab-suppliers">Fournisseurs</button>
          <button class="tab-btn" data-tab="tab-companies">Soci√©t√©s</button>
          <button class="tab-btn" data-tab="tab-email">Email (Gmail)</button>
        </nav>

        <div class="tab-content">
          <div id="tab-products" class="tab-pane active">
            <h3>Produits</h3>
            <div class="form-row">
              <label>Nom du produit
                <input type="text" id="product-name" placeholder="Ex: √âtuis √† lunettes"/>
              </label>
              <label>Prix de vente (‚Ç¨)
                <input type="number" id="product-price" value="3" min="0" step="0.01"/>
              </label>
              <label>Stock initial
                <input type="number" id="product-stock" value="0" min="0"/>
              </label>
              <button class="primary" id="btn-add-product">Ajouter le produit</button>
            </div>
            <table id="table-products">
              <thead>
                <tr><th>#</th><th>Nom</th><th>Prix</th><th>Stock</th><th>Co√ªt r√©el</th><th>Marge</th><th>Actions</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div id="tab-raw-materials" class="tab-pane">
            <h3>üß± Mati√®res premi√®res</h3>
            <div class="form-row">
              <label>Nom de la mati√®re
                <input type="text" id="raw-material-name" placeholder="Ex: Liner (tissu)"/>
              </label>
              <label>Unit√©
                <input type="text" id="raw-material-unit" placeholder="Ex: m√®tre, unit√©" value="unit√©"/>
              </label>
              <label>Co√ªt unitaire (‚Ç¨)
                <input type="number" id="raw-material-cost" value="0" min="0" step="0.01"/>
              </label>
              <label>Stock actuel
                <input type="number" id="raw-material-stock" value="0" min="0" step="0.01"/>
              </label>
              <button class="primary" id="btn-add-raw-material">Ajouter la mati√®re</button>
            </div>
            <table id="table-raw-materials">
              <thead>
                <tr><th>#</th><th>Nom</th><th>Unit√©</th><th>Co√ªt unitaire</th><th>Stock</th><th>Actions</th></tr>
              </thead>
              <tbody></tbody>
            </table>

            <h3 style="margin-top:32px">üì¶ Achats de mati√®res premi√®res</h3>
            <div class="form-row">
              <label>Date
                <input type="date" id="raw-purchase-date" />
              </label>
              <label>Mati√®re premi√®re
                <select id="raw-purchase-material"></select>
              </label>
              <label>Soci√©t√©
                <select id="raw-purchase-company"></select>
              </label>
              <label>Quantit√©
                <input type="number" id="raw-purchase-qty" value="1" min="0.01" step="0.01"/>
              </label>
              <label>Co√ªt unitaire (‚Ç¨)
                <input type="number" id="raw-purchase-cost" value="0" min="0" step="0.01"/>
              </label>
              <button class="primary" id="btn-add-raw-purchase">Enregistrer l'achat</button>
            </div>
            <table id="table-raw-purchases">
              <thead>
                <tr><th>Date</th><th>Mati√®re</th><th>Fournisseur</th><th>Soci√©t√©</th><th>Qt√©</th><th>Co√ªt unit.</th><th>Total</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- Role participants modal -->
          <div id="role-participants-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
            <div style="background:#fff;padding:16px;border-radius:8px;min-width:320px;max-width:520px;margin:16px">
              <h3 id="role-participants-title">Configurer participants par r√¥le</h3>
              <div id="role-participants-body" style="display:grid;gap:8px;margin-top:8px;max-height:60vh;overflow:auto"></div>
              <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
                <button id="role-participants-cancel">Annuler</button>
                <button id="role-participants-save" class="primary">Enregistrer</button>
              </div>
            </div>
          </div>

          <div id="tab-companies" class="tab-pane">
            <h3>Soci√©t√©s (multi-company)</h3>
            <div class="form-row">
              <label>Code (unique)
                <input type="text" id="company-code-new" placeholder="ex: manouk" />
              </label>
              <label>Nom
                <input type="text" id="company-name-new" placeholder="Nom de la soci√©t√©" />
              </label>
              <label>Email (pour recevoir les copies de factures)
                <input type="email" id="company-email-new" placeholder="email@societe.com" />
              </label>
              <div style="display:flex;align-items:center">
                <button class="primary" id="btn-add-company">Ajouter la soci√©t√©</button>
              </div>
            </div>

            <h4 style="margin-top:12px">Soci√©t√©s existantes</h4>
            <table id="table-companies">
              <thead>
                <tr><th>#</th><th>Code</th><th>Nom</th><th>Email</th><th>Actions</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div id="tab-customers" class="tab-pane">
            <h3>Clients</h3>
            <div class="form-row">
              <label>Nom
                <input type="text" id="customer-name" placeholder="Nom du client"/>
              </label>
              <label>Email
                <input type="email" id="customer-email" placeholder="email (pour envoi facture)"/>
              </label>
              <button class="primary" id="btn-add-customer">Ajouter le client</button>
            </div>
            <ul id="list-customers"></ul>
          </div>

          <div id="tab-suppliers" class="tab-pane">
            <h3>Fournisseurs</h3>
            <div class="form-row">
              <label>Nom
                <input type="text" id="supplier-name" placeholder="Nom du fournisseur"/>
              </label>
              <button class="primary" id="btn-add-supplier">Ajouter le fournisseur</button>
            </div>
            <ul id="list-suppliers"></ul>
          </div>

          <div id="tab-email" class="tab-pane">
            <h3>Configuration Email (SMTP / Gmail)</h3>
            <p class="muted">Utilisez un mot de passe d'application Gmail (ou vos identifiants SMTP). Les param√®tres sont stock√©s localement.</p>

            <h4>Informations soci√©t√©</h4>
            <div class="form-row">
              <label>Nom de la soci√©t√©
                <input type="text" id="company-name" placeholder="Nom ou votre nom" />
              </label>
              <label>Adresse
                <input type="text" id="company-address" placeholder="Adresse compl√®te" />
              </label>
              <label>SIRET / SIREN
                <input type="text" id="company-siret" placeholder="SIRET ou SIREN" />
              </label>
              <label>Mentions l√©gales (auto-entrepreneur)
                <input type="text" id="company-legal" placeholder="Ex: TVA non applicable, art. 293 B CGI" />
              </label>
              <label>Logo (chemin relatif ex: logo.png)
                <div style="display:flex;gap:8px;align-items:center">
                  <input type="text" id="company-logo" placeholder="logo.png" />
                  <button type="button" id="btn-browse-logo" class="primary" style="padding:6px 10px">Parcourir</button>
                </div>
              </label>
              <button class="primary" id="btn-save-company">Enregistrer soci√©t√©</button>
            </div>
            <div class="form-row">
              <label>SMTP Host
                <input type="text" id="smtp-host" placeholder="smtp.gmail.com" />
              </label>
              <label>Port
                <input type="number" id="smtp-port" value="465" />
              </label>
              <label>Secure
                <select id="smtp-secure"><option value="true">Oui (SSL)</option><option value="false">Non (TLS)</option></select>
              </label>
              <label>Utilisateur (email)
                <input type="email" id="smtp-user" placeholder="votre@exemple.com" />
              </label>
              <label>Mot de passe / App Password
                <input type="password" id="smtp-pass" placeholder="mot de passe" />
              </label>
              <button class="primary" id="btn-save-smtp">Enregistrer SMTP</button>
            </div>

            <h4>Tester l'envoi</h4>
            <div class="form-row">
              <label>Destinataire
                <input type="email" id="test-to" placeholder="destinataire@exemple.com" />
              </label>
              <label>Sujet
                <input type="text" id="test-subject" placeholder="Test email" />
              </label>
              <label>Message
                <textarea id="test-body" placeholder="Bonjour, ceci est un test." style="width:100%;height:80px"></textarea>
              </label>
              <button class="primary" id="btn-send-test">Envoyer test</button>
            </div>
            <div id="email-result" style="margin-top:8px;color:green"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Toast container -->
    <div id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="renderer.js"></script>
  </main>
  <!-- Email compose modal -->
  <div id="email-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:16px;border-radius:8px;min-width:320px;max-width:720px;margin:16px">
      <h3>Composer l'email</h3>
      <div style="display:grid;gap:8px">
        <label>√Ä<br/><input type="email" id="email-to" style="width:100%" /></label>
        <label>Sujet<br/><input type="text" id="email-subject" style="width:100%" /></label>
        <label>Message<br/><textarea id="email-body" style="width:100%;height:160px"></textarea></label>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button id="email-cancel" style="padding:8px 12px">Annuler</button>
          <button id="email-send" class="primary" style="padding:8px 12px">Envoyer</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Shares edit modal -->
  <div id="shares-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:16px;border-radius:8px;min-width:320px;max-width:520px;margin:16px">
      <h3 id="shares-modal-title">√âditer les parts</h3>
      <div id="shares-modal-body" style="display:grid;gap:8px;margin-top:8px;">
        <!-- inputs inserted dynamically -->
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="shares-cancel">Annuler</button>
        <button id="shares-save" class="primary">Enregistrer</button>
      </div>
    </div>
  </div>
  <!-- Role allocation modal (per invoice line) -->
  <div id="role-alloc-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:16px;border-radius:8px;min-width:320px;max-width:720px;margin:16px">
      <h3 id="role-alloc-title">R√©partition par r√¥les</h3>
      <div id="role-alloc-body" style="display:grid;gap:8px;margin-top:8px;max-height:60vh;overflow:auto">
        <!-- rows inserted dynamically -->
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="role-alloc-cancel">Annuler</button>
        <button id="role-alloc-save" class="primary">Enregistrer</button>
      </div>
    </div>
  </div>
  <!-- Modal URSSAF D√©claration -->
  <div id="urssaf-declare-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:20px;border-radius:8px;min-width:320px">
      <h3>üìã D√©clarer l'URSSAF</h3>
      <label>Date de d√©claration
        <input type="date" id="urssaf-declare-date-input" style="width:100%;margin-top:6px" />
      </label>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px">
        <button id="urssaf-declare-cancel">Annuler</button>
        <button id="urssaf-declare-confirm" class="primary">D√©clarer</button>
      </div>
    </div>
  </div>

  <!-- Modal URSSAF Paiement -->
  <div id="urssaf-pay-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:20px;border-radius:8px;min-width:320px">
      <h3>üí∂ Payer l'URSSAF</h3>
      <label>Date de paiement
        <input type="date" id="urssaf-pay-date-input" style="width:100%;margin-top:6px" />
      </label>
      <label style="margin-top:12px">Montant
        <input type="number" id="urssaf-pay-amount-input" min="0" step="0.01" placeholder="0.00" style="width:100%;margin-top:6px" />
      </label>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px">
        <button id="urssaf-pay-cancel">Annuler</button>
        <button id="urssaf-pay-confirm" class="primary">Payer</button>
      </div>
    </div>
  </div>

  <!-- Modal Paiement Facture -->
  <div id="invoice-pay-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:20px;border-radius:8px;min-width:350px">
      <h3>üí∞ Paiement de la facture</h3>
      <div style="margin:16px 0">
        <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
          <input type="radio" name="payment-type" value="total" id="payment-type-total" checked />
          <span>Paiement total</span>
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          <input type="radio" name="payment-type" value="partial" id="payment-type-partial" />
          <span>Paiement partiel</span>
        </label>
      </div>
      <div id="partial-amount-container" style="display:none;margin-top:12px">
        <label>Montant du paiement
          <input type="number" id="invoice-pay-amount-input" min="0" step="0.01" placeholder="0.00" style="width:100%;margin-top:6px" />
        </label>
      </div>
      <label style="margin-top:12px">Date de paiement
        <input type="date" id="invoice-pay-date-input" style="width:100%;margin-top:6px" />
      </label>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px">
        <button id="invoice-pay-cancel">Annuler</button>
        <button id="invoice-pay-confirm" class="primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Invoice edit modal (edit whole invoice before create) -->
  <div id="invoice-edit-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:16px;border-radius:8px;min-width:320px;max-width:900px;margin:16px">
      <h3 id="invoice-edit-title">Cr√©er la facture</h3>
      <div style="display:grid;gap:8px">
        <label>Date de la facture
          <input type="date" id="invoice-edit-date" style="width:100%" />
        </label>
        <label>Client
          <select id="invoice-edit-customer" style="width:100%"></select>
        </label>
        <label style="display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="invoice-edit-send-email" />
          <span>Envoyer automatiquement par email au client</span>
        </label>

        <div class="card" style="margin-top:8px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <strong>Lignes de facture (√©dition)</strong>
            <div>
              <button id="invoice-edit-add-line" class="primary" style="padding:6px 10px">Ajouter une ligne</button>
            </div>
          </div>
          <div id="invoice-edit-lines" style="display:grid;gap:8px;max-height:50vh;overflow:auto">
            <!-- lines inserted dynamically -->
          </div>
        </div>

        <div class="card" style="margin-top:8px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <strong>Paiements</strong>
            <div>
              <button id="invoice-edit-add-payment" class="primary" style="padding:6px 10px">Ajouter un paiement</button>
            </div>
          </div>
          <div id="invoice-edit-payments" style="display:grid;gap:8px;max-height:30vh;overflow:auto">
            <!-- payment rows inserted dynamically -->
          </div>
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button id="invoice-edit-cancel">Annuler</button>
          <button id="invoice-edit-save" class="primary">Cr√©er la facture</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Product role config modal: configure companies + amounts per role -->
  <div id="product-role-config-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:16px;border-radius:8px;min-width:320px;max-width:720px;margin:16px">
      <h3 id="product-role-config-title">Configurer r√¥les et parts</h3>
      <div id="product-role-config-body" style="display:grid;gap:8px;margin-top:8px;max-height:60vh;overflow:auto">
        <!-- rows inserted dynamically: for each role -> amount input + company checkboxes -->
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="product-role-config-cancel">Annuler</button>
        <button id="product-role-config-save" class="primary">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Product materials modal: configure BOM (nomenclature) -->
  <div id="product-materials-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;padding:16px;border-radius:8px;min-width:400px;max-width:720px;margin:16px">
      <h3 id="product-materials-title">üß± Composition du produit</h3>
      <p style="color:var(--muted);font-size:0.9rem">D√©finissez les mati√®res premi√®res n√©cessaires pour fabriquer ce produit</p>
      
      <div id="product-materials-body" style="margin-top:16px;max-height:60vh;overflow:auto">
        <!-- Material rows inserted dynamically -->
      </div>
      
      <div style="margin-top:16px">
        <button id="btn-add-material-row" style="padding:8px 12px">+ Ajouter une mati√®re</button>
      </div>
      
      <div style="background:#f8fafc;padding:12px;border-radius:8px;margin-top:16px">
        <strong>üí∞ Co√ªt calcul√© : <span id="calculated-cost">0.00 ‚Ç¨</span></strong>
      </div>
      
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px">
        <button id="product-materials-cancel">Annuler</button>
        <button id="product-materials-save" class="primary">Enregistrer</button>
      </div>
    </div>
  </div>
</body>
</html>
